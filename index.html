<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LogiTrace AI Console</title>
    <style>
        body { font-family: 'Courier New', monospace; background: #0f172a; color: #38bdf8; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; }
        .input-group { background: #1e293b; padding: 20px; border-radius: 8px; border: 1px solid #334155; }
        textarea, input { width: 100%; background: #0f172a; border: 1px solid #334155; color: #fff; padding: 10px; margin: 10px 0; border-radius: 4px; }
        button { background: #2563eb; color: white; border: none; padding: 12px; width: 100%; cursor: pointer; font-weight: bold; border-radius: 4px; }
        .stats { font-size: 12px; margin-bottom: 10px; color: #94a3b8; }
        .console-window { background: #000; height: 300px; border: 1px solid #334155; border-radius: 8px; padding: 15px; overflow-y: auto; margin-top: 20px; }
        .log-entry { margin-bottom: 5px; font-size: 13px; }
        .log-time { color: #64748b; }
        .log-msg { color: #10b981; margin-left: 10px; }
        pre { background: #1e293b; color: #38bdf8; padding: 15px; border-radius: 8px; margin-top: 20px; display: none; }
    </style>
</head>
<body>
    <div class="container">
        <div class="input-group">
            <div class="stats">SYSTEM: <b id="status" style="color:#10b981">IDLE</b> | CORES: 16 | RAM: 128GB</div>
            <h2>LOGITRACE_V2.5_PIPELINE</h2>
            <textarea id="prompt" rows="3">Extract Invoice Details or LC data as JSON</textarea>
            <input type="file" id="fileInput">
            <button id="btn" onclick="runScan()">EXECUTE_PIPELINE</button>
        </div>
        <div class="console-window" id="console"></div>
        <pre id="output"></pre>
    </div>

    <script>
        const consoleEl = document.getElementById('console');
        const statusEl = document.getElementById('status');
        const ws = new WebSocket(`ws://${window.location.host}/ws`);

        ws.onmessage = (event) => {
            const data = JSON.parse(event.data);
            const div = document.createElement('div');
            div.className = 'log-entry';
            div.innerHTML = `<span class="log-time">[${data.time}]</span><span class="log-msg">${data.msg}</span>`;
            consoleEl.appendChild(div);
            consoleEl.scrollTop = consoleEl.scrollHeight;
        };

        async function runScan() {
            const file = document.getElementById('fileInput').files[0];
            if(!file) return alert("Select file");
            
            statusEl.innerText = "PROCESSING";
            statusEl.style.color = "#ef4444";
            document.getElementById('output').style.display = 'none';

            const formData = new FormData();
            formData.append('file', file);
            formData.append('prompt', document.getElementById('prompt').value);

            const res = await fetch('/scan', { method: 'POST', body: formData });
            const data = await res.json();
            
            document.getElementById('output').innerText = JSON.stringify(data, null, 2);
            document.getElementById('output').style.display = 'block';
            statusEl.innerText = "IDLE";
            statusEl.style.color = "#10b981";
        }
    </script>
</body>
</html>